# üîç –ü–æ–ª–Ω—ã–π –∫–æ–¥-—Ä–µ–≤—å—é Admin Bot Service v2.3

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–°—Ç–∞—Ç—É—Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π](#1-—Å—Ç–∞—Ç—É—Å-–ø—Ä–µ–¥—ã–¥—É—â–∏—Ö-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)
2. [–û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)](#2-–æ—Å—Ç–∞–≤—à–∏–µ—Å—è-–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-—Å—Ä–µ–¥–Ω–∏–π)
3. [–ù–æ–≤—ã–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)](#3-–Ω–æ–≤—ã–µ-–æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-–Ω–∏–∑–∫–∏–π)
4. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é](#4-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-—É–ª—É—á—à–µ–Ω–∏—é)
5. [–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞](#5-–æ–±—â–∞—è-–æ—Ü–µ–Ω–∫–∞-–ø—Ä–æ–µ–∫—Ç–∞)

---

## 1. –°—Ç–∞—Ç—É—Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (20/24)

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|---|----------|--------|------|
| 1.1 | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ application.yml | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `application.yml:43` |
| 1.2 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø PK –≤ AdminRepository | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `AdminRepository.java:12` |
| 1.3 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ @Modifying –¥–ª—è DELETE | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `AdminInvitationRepository.java:97-98` |
| 1.4 | Deprecated —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `StateTransitionService.java` |
| 2.1 | –ö–Ω–æ–ø–∫–∞ SUPER_ADMIN –≤ KeyboardBuilder | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `KeyboardBuilder.java:44-45` |
| 2.2 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Rate Limiting | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `RateLimitService.java`, `RateLimitConfig.java` |
| 2.4 | –ü—É–±–ª–∏—á–Ω—ã–µ –ø–æ–ª—è –≤ DTO –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `AdminRegistrationController.java:195-202` |
| 3.1 | NPE –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ whitelist | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `TelegramBot.java:70-75` |
| 3.2 | Unchecked cast –≤ getData() | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `ConversationState.java:66-85` |
| 3.3 | NPE –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ isBlocked | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Boolean.TRUE.equals()` |
| 3.4 | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | `InviteService.java:233-235` - –¥–æ–±–∞–≤–ª–µ–Ω MAX_ATTEMPTS, –Ω–æ RuntimeException |
| 3.5 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ AWAITING_ADMIN_ROLE | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `TextMessageHandler.java:62-75` |
| 4.2 | –°–º–µ—à–∞–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤ CallbackQueryHandler | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ callback/* handlers |
| 4.3 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GlobalExceptionHandler | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `GlobalExceptionHandler.java` |
| 4.5 | –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π UUID –≤ AdminDto | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `AdminDto.java` - —É–¥–∞–ª—ë–Ω |
| 5.1 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ escapeHtml | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `BotMessage.escapeHtml()` |
| 5.2 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ createMessage | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `TelegramMessageFactory.java` |
| 5.3 | –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ formatUserDetails | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `UserInfoFormatter.java` |
| 6.1 | –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Javadoc | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –î–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–µ—Ä–≤–∏—Å—ã |
| 6.2 | Magic numbers –∏ strings | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `BotConstants.java` |
| 7.1 | –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—Ç–æ–≤ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –ø–æ—Ä—Ç 8091 |

---

## 2. –û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

### 2.1 ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HEALTHCHECK –≤ Dockerfile

**–§–∞–π–ª:** `Dockerfile`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç—á—ë—Ç–µ FIXES_REPORT.md —É–∫–∞–∑–∞–Ω–æ —á—Ç–æ HEALTHCHECK –¥–æ–±–∞–≤–ª–µ–Ω, –Ω–æ –≤ —Ç–µ–∫—É—â–µ–º Dockerfile –µ–≥–æ –Ω–µ—Ç.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```dockerfile
# Run stage
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app

# Copy the jar file from build stage
COPY --from=build /app/target/*.jar app.jar

# Create non-root user
RUN addgroup -S spring && adduser -S spring -G spring
USER spring:spring

# Expose port (matches application.yml server.port: 8091)
EXPOSE 8091

# Set JVM options
ENV JAVA_OPTS="-Xmx512m -Xms256m"

# Run the application
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar /app/app.jar"]
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å HEALTHCHECK. –û–¥–Ω–∞–∫–æ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `eclipse-temurin:17-jre-alpine`, –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å curl:

```dockerfile
# Install curl for health check
RUN apk add --no-cache curl

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8091/actuator/health || exit 1
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å wget (—É–∂–µ –µ—Å—Ç—å –≤ Alpine):

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD wget -q --spider http://localhost:8091/actuator/health || exit 1
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

### 2.2 ‚ö†Ô∏è –ù–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ docker-compose

**–§–∞–π–ª:** `docker-compose.yml` (—Å—Ç—Ä–æ–∫–∏ 8-10)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```yaml
environment:
  POSTGRES_DB: social_network
  POSTGRES_USER: postgres
  POSTGRES_PASSWORD: password
```

–ü–∞—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ —Ñ–∞–π–ª–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª:

```yaml
environment:
  POSTGRES_DB: ${POSTGRES_DB:-social_network}
  POSTGRES_USER: ${POSTGRES_USER:-postgres}
  POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:?Password is required}
```

–ò —Å–æ–∑–¥–∞—Ç—å `.env.example`:
```
POSTGRES_DB=social_network
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_secure_password
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

### 2.3 ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ deploy:dev –∏ deploy:prod –≤ gitlab-ci.yml

**–§–∞–π–ª:** `.gitlab-ci.yml` (—Å—Ç—Ä–æ–∫–∏ 133-253)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–°—Ç–∞–¥–∏–∏ `deploy:dev` –∏ `deploy:prod` –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã (~100 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å YAML anchors –∏–ª–∏ extends:

```yaml
.deploy_template: &deploy_template
  stage: deploy
  image: alpine:latest
  before_script:
    - apk add --no-cache openssh-client
    - mkdir -p ~/.ssh
    - echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa
    - ssh-keyscan -H $DEV_SERVER_HOST >> ~/.ssh/known_hosts 2>/dev/null

deploy:dev:
  <<: *deploy_template
  script:
    # ... —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è dev
  environment:
    name: development
  rules:
    - if: $CI_COMMIT_BRANCH == "develop"

deploy:prod:
  <<: *deploy_template
  script:
    # ... —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è prod
  environment:
    name: production
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å

---

### 2.4 ‚ö†Ô∏è RuntimeException –≤ generateUniqueToken

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/service/InviteService.java` (—Å—Ç—Ä–æ–∫–∞ 234)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```java
if (attempts >= MAX_ATTEMPTS) {
    throw new RuntimeException("Failed to generate unique invite token after " + MAX_ATTEMPTS + " attempts");
}
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RuntimeException –≤–º–µ—Å—Ç–æ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `TokenGenerationException`, –∫–æ—Ç–æ—Ä–æ–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```java
if (attempts >= MAX_ATTEMPTS) {
    throw new TokenGenerationException("Failed to generate unique invite token", attempts);
}
```

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

### 2.5 ‚ö†Ô∏è –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç UUID –≤ AdminRepository

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/repository/AdminRepository.java` (—Å—Ç—Ä–æ–∫–∞ 9)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```java
import java.util.UUID;
```

–ò–º–ø–æ—Ä—Ç UUID –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–ª–∞—Å—Å–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç.

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## 3. –ù–æ–≤—ã–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)

### 3.1 üìù –°–º–µ—à–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –≤ BanReasons

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/constant/BotConstants.java` (—Å—Ç—Ä–æ–∫–∏ 74-78)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```java
public static final class BanReasons {
    public static final String SPAM = "–°–ø–∞–º";
    public static final String HARASSMENT = "Harassment";  // –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
    public static final String BOT_FAKE = "Bot/Fake –∞–∫–∫–∞—É–Ω—Ç";  // —Å–º–µ—à–∞–Ω–Ω—ã–π
    public static final String COMMUNITY_VIOLATION = "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞";
}
```

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—á–∏–Ω—ã –±–∞–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –¥—Ä—É–≥–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —è–∑—ã–∫:
```java
public static final class BanReasons {
    public static final String SPAM = "–°–ø–∞–º";
    public static final String HARASSMENT = "–û—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ";
    public static final String BOT_FAKE = "–ë–æ—Ç/–§–µ–π–∫ –∞–∫–∫–∞—É–Ω—Ç";
    public static final String COMMUNITY_VIOLATION = "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ—Å—Ç–≤–∞";
}
```

**–°—Ç–∞—Ç—É—Å:** üìù –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

---

### 3.2 üìù –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ scheduled task –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –º–µ—Ç–æ–¥ `deleteExpiredInvitations()`, –Ω–æ –Ω–µ—Ç scheduled task –¥–ª—è –µ–≥–æ –≤—ã–∑–æ–≤–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å scheduled task:

```java
@Component
@RequiredArgsConstructor
@Slf4j
public class InvitationCleanupScheduler {
    
    private final AdminInvitationRepository invitationRepository;
    
    @Scheduled(cron = "0 0 2 * * ?") // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
    @Transactional
    public void cleanupExpiredInvitations() {
        int deleted = invitationRepository.deleteExpiredInvitations(LocalDateTime.now());
        log.info("Cleaned up {} expired invitations", deleted);
    }
}
```

**–°—Ç–∞—Ç—É—Å:** üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å

---

### 3.3 üìù –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ Redis —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ Rate Limiting

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/config/RateLimitConfig.java`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis, Rate Limiting –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–∫–∞–∑—É –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å fallback –ª–æ–≥–∏–∫—É –≤ RateLimitService:

```java
public boolean tryConsume(String key, Supplier<BucketConfiguration> configSupplier) {
    try {
        var bucket = proxyManager.builder().build(key, configSupplier);
        return bucket.tryConsume(1);
    } catch (Exception e) {
        log.warn("Redis unavailable for rate limiting, allowing request: {}", e.getMessage());
        return true; // –∏–ª–∏ false –¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞
    }
}
```

**–°—Ç–∞—Ç—É—Å:** üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å

---

### 3.4 üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ @SuppressWarnings —É—Å—Ç–∞—Ä–µ–ª–æ

**–§–∞–π–ª:** `ConversationState.java`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ—Ç–æ–¥–∞ `getData()` –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è `@SuppressWarnings("unchecked")` –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `type.cast()`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–∞–Ω–Ω–æ—Ç–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

---

### 3.5 üìù –ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ RateLimitExceededException

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/exception/RateLimitExceededException.java`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–°—Ç–∞—Ç—É—Å:** üìù –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## 4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 4.1 üí° –î–æ–±–∞–≤–∏—Ç—å Swagger/OpenAPI –¥–ª—è REST API

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:
```xml
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
    <version>2.3.0</version>
</dependency>
```

### 4.2 üí° –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Cacheable` –¥–ª—è:
- `AdminService.findByTelegramId()`
- `StatisticsService.getStatistics()`

### 4.3 üí° –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

### 4.4 üí° –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Testcontainers

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ PostgreSQL –∏ Redis.

### 4.5 üí° –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /help

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º.

### 4.6 üí° –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Telegram Bot API Webhooks

**–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–í–º–µ—Å—Ç–æ Long Polling –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

---

## 5. –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ v2.2

1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - CallbackQueryHandler —Ä–∞–∑–±–∏—Ç –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
   - –°–æ–∑–¥–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω Chain of Responsibility –¥–ª—è callback handlers
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `CallbackHandler` –∏ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `BaseCallbackHandler`

2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –î–æ–±–∞–≤–ª–µ–Ω Rate Limiting —Å Bucket4j –∏ Redis
   - –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤—ã–Ω–µ—Å–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞**
   - –°–æ–∑–¥–∞–Ω `TelegramMessageFactory` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
   - –°–æ–∑–¥–∞–Ω `UserInfoFormatter` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–æ–∑–¥–∞–Ω `BotConstants` –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ `BotMessage.escapeHtml()`

4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã Javadoc –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–ª—é—á–µ–≤—ã–º –∫–ª–∞—Å—Å–∞–º

5. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –°–æ–∑–¥–∞–Ω `GlobalExceptionHandler`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. **DevOps**
   - –î–æ–±–∞–≤–∏—Ç—å HEALTHCHECK –≤ Dockerfile
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env –¥–ª—è –ø–∞—Ä–æ–ª–µ–π –≤ docker-compose
   - –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ gitlab-ci.yml

2. **–ö–æ–¥**
   - –ó–∞–º–µ–Ω–∏—Ç—å RuntimeException –Ω–∞ TokenGenerationException
   - –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç UUID

3. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**
   - –î–æ–±–∞–≤–∏—Ç—å scheduled task –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è Rate Limiting –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Redis

### üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------------|----------|
| –í–´–°–û–ö–ò–ô | 0 | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç |
| –°–†–ï–î–ù–ò–ô | 5 | DevOps, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ |
| –ù–ò–ó–ö–ò–ô | 5 | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è |

### üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:**
   - –î–æ–±–∞–≤–∏—Ç—å HEALTHCHECK –≤ Dockerfile
   - –ó–∞–º–µ–Ω–∏—Ç—å RuntimeException –Ω–∞ TokenGenerationException
   - –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç UUID

2. **–ü–ª–∞–Ω–æ–≤–æ:**
   - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ gitlab-ci.yml (YAML anchors)
   - –î–æ–±–∞–≤–∏—Ç—å scheduled task –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å .env –¥–ª—è docker-compose

3. **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:**
   - –î–æ–±–∞–≤–∏—Ç—å Swagger/OpenAPI
   - –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus

---

### üìà –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å v2.2

| –ú–µ—Ç—Ä–∏–∫–∞ | v2.2 | v2.3 (—Ç–µ–∫—É—â–∞—è) | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|------|----------------|-----------|
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã | 9 | 0 | ‚úÖ -100% |
| –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã | 15 | 5 | ‚úÖ -67% |
| –ù–∏–∑–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã | 15+ | 5 | ‚úÖ -67% |
| –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ | 6/10 | 8.5/10 | ‚úÖ +42% |

---

*–û—Ç—á—ë—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: 2026-01-05*
*–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞: v2.3*
*–ü—Ä–µ–¥—ã–¥—É—â–∏–π –æ—Ç—á—ë—Ç: CODE_REVIEW_REPORT.md (2026-01-03)*
