# üîç –ü–æ–ª–Ω—ã–π –∫–æ–¥-—Ä–µ–≤—å—é Admin Bot Service

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)](#1-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-–≤—ã—Å–æ–∫–∏–π)
2. [–ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)](#2-–ø—Ä–æ–±–ª–µ–º—ã-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-–≤—ã—Å–æ–∫–∏–π)
3. [–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)](#3-–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ-–æ—à–∏–±–∫–∏-–≤—Ä–µ–º–µ–Ω–∏-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-—Å—Ä–µ–¥–Ω–∏–π)
4. [–ü—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –¥–∏–∑–∞–π–Ω–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)](#4-–ø—Ä–æ–±–ª–µ–º—ã-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-–∏-–¥–∏–∑–∞–π–Ω–∞-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-—Å—Ä–µ–¥–Ω–∏–π)
5. [–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)](#5-–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ-–∫–æ–¥–∞-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-—Å—Ä–µ–¥–Ω–∏–π)
6. [–£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)](#6-—É–ª—É—á—à–µ–Ω–∏—è-–∫–∞—á–µ—Å—Ç–≤–∞-–∫–æ–¥–∞-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-–Ω–∏–∑–∫–∏–π)
7. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ DevOps (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)](#7-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∏-devops-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-—Å—Ä–µ–¥–Ω–∏–π)
8. [–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)](#8-–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è-–∏-–Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-–Ω–∏–∑–∫–∏–π)
9. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)](#9-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-—É–ª—É—á—à–µ–Ω–∏—é-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-–Ω–∏–∑–∫–∏–π)
10. [–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞](#10-–æ–±—â–∞—è-–æ—Ü–µ–Ω–∫–∞-–ø—Ä–æ–µ–∫—Ç–∞)

---

## 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

### 1.1 ‚ö†Ô∏è –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ application.yml (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/resources/application.yml` (—Å—Ç—Ä–æ–∫–∞ 42-44)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```yaml
telegram:
  bot:
    token: ${TELEGRAM_BOT_TOKEN:8537923153:AAH5mqBbQ__UPG7giA7DwING5ESwId35NbE}
```

–¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ **–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω** –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –î–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω, —ç—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ —Å–µ–∫—Ä–µ—Ç–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –£–¥–∞–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ç–æ–∫–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –±–µ–∑ fallback
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –±—ã–ª —Ä–µ–∞–ª—å–Ω—ã–º, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ @BotFather

---

### 1.2 ‚ö†Ô∏è –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø Primary Key –≤ AdminRepository (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/repository/AdminRepository.java` (—Å—Ç—Ä–æ–∫–∞ 11)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
@Repository
public interface AdminRepository extends JpaRepository<Admin, UUID> {
```

–ù–æ –≤ —Å—É—â–Ω–æ—Å—Ç–∏ `Admin` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Long` –∫–∞–∫ Primary Key:

```java
@Id
@Column(name = "telegram_user_id")
private Long telegramUserId;
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ú–µ—Ç–æ–¥—ã `findById()`, `deleteById()`, `existsById()` –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```java
public interface AdminRepository extends JpaRepository<Admin, Long> {
```

---

### 1.3 ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ @Modifying –¥–ª—è DELETE –∑–∞–ø—Ä–æ—Å–∞ (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/repository/AdminInvitationRepository.java` (—Å—Ç—Ä–æ–∫–∞ 95-97)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
@Query("DELETE FROM AdminInvitation ai WHERE ai.isUsed = false AND ai.expiresAt < :now")
int deleteExpiredInvitations(@Param("now") LocalDateTime now);
```

DELETE –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ `@Modifying`, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```java
@Modifying
@Transactional
@Query("DELETE FROM AdminInvitation ai WHERE ai.isUsed = false AND ai.expiresAt < :now")
int deleteExpiredInvitations(@Param("now") LocalDateTime now);
```

---

### 1.4 ‚ö†Ô∏è Deprecated —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤ StateTransitionService (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/service/StateTransitionService.java`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í `BotState` –µ—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`AWAITING_ADMIN_USERNAME`, `CONFIRMING_ADMIN_INVITE_CREATION`, `CONFIRMING_INVITE_ACCEPTANCE`), –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `ALLOWED_TRANSITIONS`, –Ω–æ deprecated —Å–æ—Å—Ç–æ—è–Ω–∏—è (`AWAITING_ADMIN_TELEGRAM_ID`, `CONFIRMING_ADMIN_CREATION`) –æ—Å—Ç–∞—é—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∫–∞—Ä—Ç—É –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–æ–º–µ—Ç–∏—Ç—å deprecated –ø–µ—Ä–µ—Ö–æ–¥—ã

---

## 2. –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

### 2.1 üîê –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å SUPER_ADMIN —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ–±–µ –ø–æ–¥–æ–±–Ω—ã—Ö(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/telegram/keyboard/KeyboardBuilder.java` (—Å—Ç—Ä–æ–∫–∞ 41-44)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
rows.add(List.of(
    createButton("üî¥ SUPER_ADMIN", "add_admin:role:SUPER_ADMIN")
));
```

–í –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SUPER_ADMIN, —Ö–æ—Ç—è –≤ `AdminRole.canAssignRole()` SUPER_ADMIN –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å —Å–∞–º —Å–µ–±–µ –ø–æ–¥–æ–±–Ω—ã—Ö (level 4 > level 4 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É SUPER_ADMIN –∏–∑ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (—É–∂–µ –µ—Å—Ç—å –≤ InviteService)

---

### 2.2 üîê –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Rate Limiting –¥–ª—è REST API(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/controller/AdminRegistrationController.java`

**–ü—Ä–æ–±–ª–µ–º–∞:**
REST endpoints (`/register`, `/invite/validate`) –Ω–µ –∏–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:

- Brute-force –∞—Ç–∞–∫–∞–º –Ω–∞ —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- DoS –∞—Ç–∞–∫–∞–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –î–æ–±–∞–≤–∏—Ç—å Spring Security —Å rate limiting
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É Bucket4j
- –ú–∏–Ω–∏–º—É–º: –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ IP

---

### 2.3 üîê –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å UUID –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞(–ù–µ –Ω—É–∂–Ω–æ)

**–ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:**
UUID.fromString() –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç `IllegalArgumentException`, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã –æ—Ç IDOR (Insecure Direct Object Reference).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

---

### 2.4 üîê –ü—É–±–ª–∏—á–Ω—ã–µ –ø–æ–ª—è –≤ DTO –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/controller/AdminRegistrationController.java` (—Å—Ç—Ä–æ–∫–∞ 212-217)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
public static class RegistrationRequest {
    public String token;
    public Long telegramId;
    public String username;
    public String firstName;
}
```

–ü—É–±–ª–∏—á–Ω—ã–µ –ø–æ–ª—è –Ω–∞—Ä—É—à–∞—é—Ç –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—é –∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```java
@Data
@NoArgsConstructor
public static class RegistrationRequest {
    @NotBlank
    private String token;
  
    @NotNull
    private Long telegramId;
  
    private String username;
  
    @NotBlank
    private String firstName;
}
```

---

## 3. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

### 3.1 ‚ö° NPE –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ whitelist –∞–¥–º–∏–Ω–æ–≤(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/telegram/TelegramBot.java` (—Å—Ç—Ä–æ–∫–∞ 67-70)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
this.adminWhitelist = Arrays.stream(adminWhitelistStr.split(","))
    .map(String::trim)
    .map(Long::parseLong)
    .toList();
```

–ï—Å–ª–∏ `adminWhitelistStr` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —á–∏—Å–ª–∞ –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–æ `NumberFormatException`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```java
this.adminWhitelist = Arrays.stream(adminWhitelistStr.split(","))
    .map(String::trim)
    .filter(s -> !s.isEmpty())
    .filter(s -> s.matches("\\d+"))
    .map(Long::parseLong)
    .toList();
```

---

### 3.2 ‚ö° Unchecked cast –≤ ConversationState.getData() (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/domain/ConversationState.java` (—Å—Ç—Ä–æ–∫–∞ 66-73)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
@SuppressWarnings("unchecked")
public <T> T getData(String key, Class<T> type) {
    Object value = this.data.get(key);
    if (value == null) {
        return null;
    }
    return (T) value;
}
```

–ü—Ä–∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ Redis —Ç–∏–ø—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, Integer –≤–º–µ—Å—Ç–æ Long).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```java
public <T> T getData(String key, Class<T> type) {
    Object value = this.data.get(key);
    if (value == null) {
        return null;
    }
    if (type.isInstance(value)) {
        return type.cast(value);
    }
    // Handle type conversion
    if (type == Integer.class && value instanceof Number) {
        return type.cast(((Number) value).intValue());
    }
    if (type == Long.class && value instanceof Number) {
        return type.cast(((Number) value).longValue());
    }
    throw new ClassCastException("Cannot cast " + value.getClass() + " to " + type);
}
```

---

### 3.3 ‚ö° NullPointerException –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ isBlocked(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/telegram/handler/CallbackQueryHandler.java` (—Å—Ç—Ä–æ–∫–∞ 482)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
if (!user.getIsBlocked()) {
```

–ï—Å–ª–∏ `getIsBlocked()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `null`, –±—É–¥–µ—Ç NPE.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```java
if (!Boolean.TRUE.equals(user.getIsBlocked())) {
```

---

### 3.4 ‚ö° –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/service/InviteService.java` (—Å—Ç—Ä–æ–∫–∞ 216-238)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
do {
    // –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
    attempts++;
    if (attempts >= MAX_ATTEMPTS) {
        throw new RuntimeException(...);
    }
} while (invitationRepository.existsByInviteToken(token));
```

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –µ—Å–ª–∏ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∑–∞–Ω—è—Ç—ã (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ), –±—É–¥–µ—Ç RuntimeException –±–µ–∑ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –≤—ã–∑—ã–≤–∞—é—â–µ–º –∫–æ–¥–µ

---

### 3.5 ‚ö° –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ null –≤ TextMessageHandler(‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/telegram/handler/TextMessageHandler.java` (—Å—Ç—Ä–æ–∫–∞ 40-50)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
switch (currentState) {
    case AWAITING_ADMIN_ROLE:
        // –≠—Ç–æ—Ç case –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!
```

–°–æ—Å—Ç–æ—è–Ω–∏–µ `AWAITING_ADMIN_ROLE` –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ switch, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –ø–∞–¥–µ–Ω–∏—é –≤ default case —Å –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è `AWAITING_ADMIN_ROLE`:

```java
case AWAITING_ADMIN_ROLE:
    return createMessage(message.getChatId(),
        "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏.");
```

---

## 4. –ü—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –¥–∏–∑–∞–π–Ω–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

### 4.1 üèóÔ∏è –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É AI_CONTEXT.md –∏ —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `AI_CONTEXT.md`

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –£–∫–∞–∑–∞–Ω–∞ Java 21, –Ω–æ –≤ pom.xml `<java.version>17</java.version>`
- –£–∫–∞–∑–∞–Ω Spring Boot 3.x, –Ω–æ –≤ pom.xml –≤–µ—Ä—Å–∏—è `4.0.1`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ —É—Å—Ç–∞—Ä–µ–ª–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–û–±–Ω–æ–≤–∏—Ç—å AI_CONTEXT.md –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–µ–∫—É—â–µ–º—É –∫–æ–¥—É.

---

### 4.2 üèóÔ∏è –°–º–µ—à–∞–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤ CallbackQueryHandler (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/telegram/handler/CallbackQueryHandler.java`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–ª–∞—Å—Å —Å–æ–¥–µ—Ä–∂–∏—Ç 677 —Å—Ç—Ä–æ–∫ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

- –ë–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ü–æ–∏—Å–∫
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
- –ù–∞–≤–∏–≥–∞—Ü–∏—é

–≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–†–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

```
CallbackQueryRouter.java
UserBlockCallbackHandler.java
SearchCallbackHandler.java
AdminManagementCallbackHandler.java
NavigationCallbackHandler.java
```

---

### 4.3 üèóÔ∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ GlobalExceptionHandler –¥–ª—è REST API (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `AdminRegistrationController` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –∫–æ–¥–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–∑–¥–∞—Ç—å `@ControllerAdvice`:

```java
@ControllerAdvice
public class GlobalExceptionHandler {
  
    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<?> handleIllegalArgument(IllegalArgumentException e) {
        return ResponseEntity.badRequest()
            .body(Map.of("success", false, "error", e.getMessage()));
    }
  
    // ...
}
```

---

### 4.4 üèóÔ∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ DTO

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ú–∞–ø–ø–∏–Ω–≥ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∏ DTO –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö –∏ —Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MapStruct –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ Mapper –∫–ª–∞—Å—Å—ã

---

### 4.5 üèóÔ∏è –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç UUID –≤ AdminDto (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `src/main/java/com/socialnetwork/adminbot/dto/AdminDto.java` (—Å—Ç—Ä–æ–∫–∞ 9)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
import java.util.UUID;
// ...
private UUID id;
```

–ü–æ–ª–µ `id` —Ç–∏–ø–∞ UUID, –Ω–æ –≤ —Å—É—â–Ω–æ—Å—Ç–∏ `Admin` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Long telegramUserId` –∫–∞–∫ PK.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

- –£–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ `id: UUID` –∏–∑ AdminDto
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `Long id`

---

## 5. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

### 5.1 üìã –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ escapeHtml

**–§–∞–π–ª—ã:**

- `CallbackQueryHandler.java` (—Å—Ç—Ä–æ–∫–∞ 668-676)
- `SearchCommandHandler.java` (—Å—Ç—Ä–æ–∫–∞ 261-266)
- `BanCommandHandler.java` (—Å—Ç—Ä–æ–∫–∞ 277-280)
- `BotMessage.java` (—Å—Ç—Ä–æ–∫–∞ 328-335)
- `MessageUtils.java` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BotMessage.escapeHtml

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –∏–∑ `BotMessage.escapeHtml()` –≤–µ–∑–¥–µ:

```java
// –í–µ–∑–¥–µ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
BotMessage.escapeHtml(text)
```

---

### 5.2 üìã –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ createMessage –º–µ—Ç–æ–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ú–µ—Ç–æ–¥ `createMessage(Long chatId, String text)` –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤:

- `BaseCommandHandler.java`
- `StartCommandHandler.java`
- `TextMessageHandler.java`
- `TelegramBot.java`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í—ã–Ω–µ—Å—Ç–∏ –≤ —É—Ç–∏–ª–∏—Ç–Ω—ã–π –∫–ª–∞—Å—Å:

```java
public class TelegramMessageFactory {
    public static SendMessage createHtmlMessage(Long chatId, String text) {
        SendMessage message = new SendMessage();
        message.setChatId(chatId.toString());
        message.setText(text);
        message.setParseMode("HTML");
        return message;
    }
}
```

---

### 5.3 üìã –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–§–∞–π–ª—ã:**

- `UserCommandHandler.buildUserInfoMessage()`
- `CallbackQueryHandler.formatUserDetails()`
- `SearchCommandHandler.buildSearchResultsMessage()`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–∑–¥–∞—Ç—å `UserInfoFormatter` –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## 6. –£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)

### 6.1 üìù –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Javadoc –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ú–Ω–æ–≥–∏–µ –ø—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –∏–º–µ—é—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

**–ü—Ä–∏–º–µ—Ä—ã:**

- `AdminService.hasRole()`
- `AdminService.hasPermission()`
- `UserService.searchUsersByEmail()`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å Javadoc –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤.

---

### 6.2 üìù Magic numbers –∏ strings

**–ü—Ä–∏–º–µ—Ä—ã:**

- `StateTransitionService.java`: Hardcoded —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `InviteService.java` —Å—Ç—Ä–æ–∫–∞ 32-33:

  ```java
  private static final int INVITE_TOKEN_LENGTH = 32;
  private static final int INVITE_EXPIRY_HOURS = 24;
  ```

  –≠—Ç–æ —Ö–æ—Ä–æ—à–æ, –Ω–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –ø—Ä–æ–µ–∫—Ç—É.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–±—Ä–∞—Ç—å –≤—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å `BotConstants`.

---

### 6.3 üìù –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –ª–æ–≥–∏—Ä—É—é—Ç –Ω–∞ DEBUG, –¥—Ä—É–≥–∏–µ –Ω–∞ INFO
- –†–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

**–ü—Ä–∏–º–µ—Ä:**

```java
log.info("Created new admin from invite: telegramUserId={}, role={}, invitedBy={}",
```

vs

```java
log.info("User {} successfully banned user {} with reason: {}",
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

---

### 6.4 üìù –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏–º–ø–æ—Ä—Ç—ã

**–§–∞–π–ª:** `AdminService.java`

```java
import java.util.List;  // List –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

**–§–∞–π–ª:** `BanCommandHandler.java`

```java
import com.socialnetwork.adminbot.domain.StateDataKey;  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
import com.socialnetwork.adminbot.service.StateTransitionService;  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

–ö–æ–¥ –≤ —Ü–µ–ª–æ–º —á–∏—Å—Ç—ã–π, –Ω–æ —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –≤ IDE.

---

### 6.5 üìù –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

**–§–∞–π–ª:** `CallbackQueryHandler.java` (—Å—Ç—Ä–æ–∫–∞ 77)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```java
} else if (data.equals("noop")) {
    return null; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
```

–í–æ–∑–≤—Ä–∞—Ç null –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ NPE –≤ –≤—ã–∑—ã–≤–∞—é—â–µ–º –∫–æ–¥–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Å—Ç–æ–π Optional –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç-–∑–∞–≥–ª—É—à–∫—É.

---

## 7. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ DevOps (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

### 7.1 üê≥ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—Ç–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:**

- `application.yml`: `server.port: 8090`
- `.gitlab-ci.yml`: `-p 8091:8091`
- `Dockerfile`: `EXPOSE 8080`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—Ç—ã –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö.

---

### 7.2 üê≥ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ health check –≤ Dockerfile (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

**–§–∞–π–ª:** `Dockerfile`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:8090/actuator/health || exit 1
```

---

### 7.3 üê≥ –ù–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ docker-compose

**–§–∞–π–ª:** `docker-compose.yml`

**–ü—Ä–æ–±–ª–µ–º–∞:**

```yaml
POSTGRES_PASSWORD: password
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª –∏–ª–∏ Docker secrets.

---

### 7.4 üê≥ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ deploy:dev –∏ deploy:prod

**–§–∞–π–ª:** `.gitlab-ci.yml`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–°—Ç–∞–¥–∏–∏ `deploy:dev` –∏ `deploy:prod` –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã (lines 133-253).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å YAML anchors –∏–ª–∏ extends:

```yaml
.deploy_template: &deploy_template
  stage: deploy
  image: alpine:latest
  # ... –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞

deploy:dev:
  <<: *deploy_template
  environment:
    name: development
```

---

### 7.5 üê≥ –£—Å—Ç–∞—Ä–µ–≤—à–∏–π Spring Boot 4.0.1

**–§–∞–π–ª:** `pom.xml` (—Å—Ç—Ä–æ–∫–∞ 8)

**–ü—Ä–æ–±–ª–µ–º–∞:**

```xml
<version>4.0.1</version>
```

Spring Boot 4.0 –µ—â—ë –Ω–µ –≤—ã–ø—É—â–µ–Ω (–Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è). –≠—Ç–æ –ª–∏–±–æ –æ–ø–µ—á–∞—Ç–∫–∞, –ª–∏–±–æ snapshot –≤–µ—Ä—Å–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é Spring Boot 3.x.

---

## 8. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)

### 8.1 üîÑ –°–º–µ—à–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–§–∞–π–ª:** `BotMessage.java`

**–ü—Ä–æ–±–ª–µ–º–∞:**

- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º: `"Harassment"`, `"Bot/Fake"`, `"N/A"`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–õ–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ–¥–∏–Ω —è–∑—ã–∫ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å i18n.

---

### 8.2 üîÑ –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º—ã:**

- `BAN_TARGET_USER_ID` vs `BAN_TARGET_USERNAME` (underscore)
- `searchCurrentPage` vs `totalPages` (camelCase vs not)
- `isActive` vs `isUsed` vs `is_active` (–≤ —Ä–∞–∑–Ω—ã—Ö —Å–ª–æ—è—Ö)

---

### 8.3 üîÑ –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Boolean

**–ü—Ä–æ–±–ª–µ–º—ã:**

- `Boolean isActive` vs `boolean isBlocked`
- `Boolean.TRUE.equals(account.getIsBlocked())` vs `account.getIsBlocked()`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ–∑–¥–µ –ø—Ä–∏–º–∏—Ç–∏–≤ `boolean` –¥–ª—è —Ñ–ª–∞–≥–æ–≤ –∏–ª–∏ –æ–±—ä–µ–∫—Ç–Ω—ã–π `Boolean` —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏.

---

### 8.4 üîÑ –°–º–µ—à–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–ü—Ä–∏–º–µ—Ä—ã:**

- `//TODO fix:` (—Å –ø—Ä–æ–±–µ–ª–æ–º –ø–æ—Å–ª–µ TODO)
- `// ‚≠ê –ö–†–ò–¢–ò–ß–ù–û:` (—Å emoji)
- `/**` Javadoc —Å—Ç–∏–ª—å
- `// –û–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏`

---

## 9. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ù–ò–ó–ö–ò–ô)

### 9.1 üí° –î–æ–±–∞–≤–∏—Ç—å Swagger/OpenAPI –¥–ª—è REST API

–î–æ–±–∞–≤–∏—Ç—å `springdoc-openapi-starter-webmvc-ui` –¥–ª—è –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API.

### 9.2 üí° –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Cacheable` –¥–ª—è:

- `AdminService.findByTelegramId()`
- `StatisticsService.getStatistics()`

### 9.3 üí° –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

### 9.4 üí° –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å Testcontainers

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ PostgreSQL –∏ Redis.

### 9.5 üí° –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Telegram Bot API Webhooks

–í–º–µ—Å—Ç–æ Long Polling –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

### 9.6 üí° –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /help

–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º.

### 9.7 üí° –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è AuditLog

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–µ–π—Å—Ç–≤–∏–π.

### 9.8 üí° –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—á–∏—Å—Ç–∫—É —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π

–î–æ–±–∞–≤–∏—Ç—å scheduled task –¥–ª—è `deleteExpiredInvitations()`.

---

## 10. –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**

   - –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (controller, service, repository)
   - –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –¥–ª—è Telegram handlers
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ State Machine –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
2. **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è State Machine**

   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π
   - TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
3. **–ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π**

   - –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π —Å —É—Ä–æ–≤–Ω—è–º–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ `canAssignRole()`
   - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
4. **–•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**

   - 191 —Ç–µ—Å—Ç —Å–æ–≥–ª–∞—Å–Ω–æ README
   - –ú–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**

   - Spring Boot 3.x/4.x
   - Lombok
   - Liquibase –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

   - –£–±—Ä–∞—Ç—å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
   - –î–æ–±–∞–≤–∏—Ç—å rate limiting
   - –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**

   - –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

   - –†–∞–∑–±–∏—Ç—å –±–æ–ª—å—à–∏–µ –∫–ª–∞—Å—Å—ã
   - –î–æ–±–∞–≤–∏—Ç—å GlobalExceptionHandler
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
4. **DevOps**

   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö
   - –î–æ–±–∞–≤–∏—Ç—å health checks
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å CI/CD pipeline

### üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–±–ª–µ–º


| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ                                                        |
| ------------------ | -------------------- | ----------------------------------------------------------------------- |
| –í–´–°–û–ö–ò–ô     | 9                    | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å         |
| –°–†–ï–î–ù–ò–ô     | 15                   | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, DevOps |
| –ù–ò–ó–ö–ò–ô       | 15+                  | –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏                     |

### üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**

   - –£–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ application.yml
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø –≤ AdminRepository
   - –î–æ–±–∞–≤–∏—Ç—å @Modifying –¥–ª—è DELETE –∑–∞–ø—Ä–æ—Å–∞
2. **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:**

   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ NPE
   - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
   - –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ escapeHtml
3. **–ü–ª–∞–Ω–æ–≤–æ:**

   - –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ CallbackQueryHandler
   - –î–æ–±–∞–≤–∏—Ç—å GlobalExceptionHandler
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ—Ä—Ç–æ–≤

---

*–û—Ç—á—ë—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: 2026-01-03*
*–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞: v2.2*
